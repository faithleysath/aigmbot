# AI GM Bot v1.1.0 å‡çº§æŒ‡å—

## âš ï¸ é‡è¦å˜æ›´

æœ¬ç‰ˆæœ¬è¿›è¡Œäº†**é‡å¤§æ¶æ„å‡çº§**ï¼Œå°† LLM é…ç½®ä»å…¨å±€é…ç½®è¿ç§»åˆ°ç”¨æˆ·çº§é¢„è®¾ç®¡ç†ç³»ç»Ÿã€‚

### ç ´åæ€§å˜æ›´

- **ç§»é™¤äº†å…¨å±€é…ç½®é¡¹ï¼š**
  - `openai_api_key`
  - `openai_base_url`
  - `openai_model_name`

- **æ–°å¢ä¾èµ–ï¼š**
  - `cryptography` - ç”¨äºåŠ å¯†å­˜å‚¨ API å¯†é’¥

---

## ğŸ“‹ å‡çº§æ­¥éª¤

### 1. å¤‡ä»½æ•°æ®ï¼ˆå¿…é¡»ï¼ï¼‰

åœ¨å‡çº§å‰ï¼Œè¯·åŠ¡å¿…å¤‡ä»½ä»¥ä¸‹æ–‡ä»¶å’Œç›®å½•ï¼š

```bash
# å¤‡ä»½æ•´ä¸ª data ç›®å½•
cp -r data/ data_backup_$(date +%Y%m%d_%H%M%S)/

# ç‰¹åˆ«é‡è¦ï¼šé…ç½®æ–‡ä»¶å’Œæ•°æ®åº“
tar -czf backup_$(date +%Y%m%d).tar.gz \
    data/aigm.db \
    data/.secret.key \
    data/llm_presets.json \
    config.json
```

### 2. æ›´æ–°ä»£ç 

```bash
git pull origin main
# æˆ–
git fetch origin
git checkout <new-version-tag>
```

### 3. å®‰è£…æ–°ä¾èµ–

```bash
pip install -r requirements.txt
# ç¡®ä¿ cryptography å·²å®‰è£…
pip install cryptography
```

### 4. é…ç½® LLM é¢„è®¾

#### 4.1 ç§èŠæ·»åŠ é¢„è®¾

æ¯ä¸ªç”¨æˆ·éœ€è¦é€šè¿‡ç§èŠæœºå™¨äººæ·»åŠ è‡ªå·±çš„ LLM é¢„è®¾ï¼š

```
/aigm llm add <é¢„è®¾åç§°> <æ¨¡å‹> <APIåœ°å€> <APIå¯†é’¥>
```

**ç¤ºä¾‹ï¼š**

```
/aigm llm add gpt4 gpt-4-turbo https://api.openai.com/v1 sk-xxxxxxxxxxxxxxxx
/aigm llm add claude claude-3-5-sonnet-20241022 https://api.anthropic.com/v1 sk-ant-xxxxxxxx
```

**æ³¨æ„äº‹é¡¹ï¼š**
- é¢„è®¾åç§°å¯ä»¥åŒ…å«ç©ºæ ¼ï¼Œéœ€ä½¿ç”¨å¼•å·ï¼š`"my gpt4"`
- API å¯†é’¥ä¼šè¢«åŠ å¯†å­˜å‚¨åœ¨ `data/llm_presets.json` ä¸­
- åŠ å¯†å¯†é’¥è‡ªåŠ¨ç”Ÿæˆåœ¨ `data/.secret.key`ï¼ˆæƒé™ 600ï¼‰

#### 4.2 ç¾¤èŠç»‘å®šé¢„è®¾

åœ¨éœ€è¦ä½¿ç”¨ AI GM çš„ç¾¤èŠä¸­ï¼Œç”¨æˆ·å¯ä»¥è´¡çŒ®ç®—åŠ›ï¼š

```
/aigm llm bind <é¢„è®¾åç§°> [æ—¶é•¿]
```

**ç¤ºä¾‹ï¼š**

```
/aigm llm bind gpt4           # æ°¸ä¹…ç»‘å®š
/aigm llm bind gpt4 30d       # ç»‘å®š 30 å¤©
/aigm llm bind gpt4 12h       # ç»‘å®š 12 å°æ—¶
/aigm llm bind gpt4 120m      # ç»‘å®š 120 åˆ†é’Ÿ
```

**ç»‘å®šæœºåˆ¶ï¼š**
- **First Come First Servedï¼ˆå…ˆåˆ°å…ˆå¾—ï¼‰**ï¼šåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªæ´»è·ƒç»‘å®š
- **ä¸´æ—¶ç»‘å®šæ”¯æŒï¼š** å¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæœ€å¤š 90 å¤©ï¼Œå¿…é¡»åŒ…å«å•ä½ m/h/dï¼‰
- **ä¿åº•æœºåˆ¶ï¼š** ç®¡ç†å‘˜å¯è®¾ç½® Fallback é¢„è®¾

#### 4.3 ç®¡ç†å‘˜è®¾ç½®ä¿åº•é¢„è®¾ï¼ˆå¯é€‰ï¼‰

```
/aigm llm set-fallback <ç”¨æˆ·ID> <é¢„è®¾åç§°>
```

è¿™æ ·å³ä½¿æ²¡æœ‰äººç»‘å®šï¼Œç¾¤èŠä¹Ÿèƒ½ä½¿ç”¨ä¿åº•é…ç½®ã€‚

### 5. å¯åŠ¨æœåŠ¡

```bash
# ç¡®ä¿ data/ ç›®å½•æƒé™æ­£ç¡®
chmod 700 data/
chmod 600 data/.secret.key  # å¦‚æœå­˜åœ¨

# å¯åŠ¨æœåŠ¡
python src/main.py
```

---

## ğŸ” å¯†é’¥ç®¡ç†æŒ‡å—

### åŠ å¯†å¯†é’¥æ–‡ä»¶

**ä½ç½®ï¼š** `data/.secret.key`

**é‡è¦æ€§ï¼š** ğŸ”´ **æå…¶é‡è¦ï¼ä¸¢å¤±åæ‰€æœ‰ API å¯†é’¥å°†æ°¸ä¹…æ— æ³•è§£å¯†ï¼**

### å¤‡ä»½ç­–ç•¥

#### æ–¹æ¡ˆ 1ï¼šæœ¬åœ°å¤‡ä»½ï¼ˆæ¨èï¼‰

```bash
# å®šæœŸå¤‡ä»½å¯†é’¥åˆ°å®‰å…¨ä½ç½®
cp data/.secret.key /secure/backup/location/.secret.key.$(date +%Y%m%d)

# è®¾ç½®å®šæ—¶ä»»åŠ¡
cat << 'EOF' | crontab -
# æ¯å¤©å‡Œæ™¨ 3 ç‚¹å¤‡ä»½å¯†é’¥
0 3 * * * cp /path/to/data/.secret.key /path/to/backup/.secret.key.$(date +\%Y\%m\%d)
EOF
```

#### æ–¹æ¡ˆ 2ï¼šç¯å¢ƒå˜é‡ï¼ˆé«˜çº§ï¼‰

å¦‚æœéœ€è¦åœ¨å¤šå®ä¾‹éƒ¨ç½²ä¸­å…±äº«å¯†é’¥ï¼š

```bash
# å¯¼å‡ºå¯†é’¥ä¸ºç¯å¢ƒå˜é‡ï¼ˆä»…ç¤ºä¾‹ï¼Œéœ€ä¿®æ”¹ä»£ç æ”¯æŒï¼‰
export AIGM_ENCRYPTION_KEY=$(cat data/.secret.key | base64)
```

### å¯†é’¥æ¢å¤

å¦‚æœéœ€è¦æ¢å¤å¯†é’¥ï¼š

```bash
# ä»å¤‡ä»½æ¢å¤
cp /backup/location/.secret.key data/.secret.key
chmod 600 data/.secret.key
```

### å¯†é’¥è½®è½¬ï¼ˆé«˜çº§ï¼‰

**å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒå¯†é’¥è½®è½¬ã€‚** å¦‚éœ€æ›´æ¢å¯†é’¥ï¼š

1. å¯¼å‡ºæ‰€æœ‰é¢„è®¾ï¼ˆæ˜æ–‡ï¼‰
2. åˆ é™¤ `data/.secret.key` å’Œ `data/llm_presets.json`
3. é‡å¯æœåŠ¡ï¼ˆè‡ªåŠ¨ç”Ÿæˆæ–°å¯†é’¥ï¼‰
4. é‡æ–°æ·»åŠ æ‰€æœ‰é¢„è®¾

---

## ğŸ³ Docker éƒ¨ç½²æ³¨æ„äº‹é¡¹

### docker-compose.yml é…ç½®

```yaml
services:
  aigmbot:
    image: aigmbot:latest
    volumes:
      # å¿…é¡»æŒ‚è½½ data ç›®å½•åˆ°æŒä¹…å·
      - aigm_data:/app/data
      - ./config.json:/app/config.json:ro
    environment:
      - TZ=Asia/Shanghai
    restart: unless-stopped

volumes:
  aigm_data:
    driver: local
```

### å¯†é’¥å¤‡ä»½ï¼ˆDocker ç¯å¢ƒï¼‰

```bash
# ä»å®¹å™¨ä¸­å¤‡ä»½å¯†é’¥
docker cp aigmbot:/app/data/.secret.key ./backup/.secret.key.$(date +%Y%m%d)

# æ¢å¤å¯†é’¥åˆ°å®¹å™¨
docker cp ./backup/.secret.key aigmbot:/app/data/.secret.key
docker exec aigmbot chmod 600 /app/data/.secret.key
```

---

## ğŸ” éªŒè¯å‡çº§

### 1. æ£€æŸ¥åŠ å¯†å¯†é’¥

```bash
# æ£€æŸ¥å¯†é’¥æ–‡ä»¶å­˜åœ¨ä¸”æƒé™æ­£ç¡®
ls -l data/.secret.key
# åº”æ˜¾ç¤ºï¼š-rw------- (600)
```

### 2. æµ‹è¯•é¢„è®¾æ·»åŠ 

ç§èŠæœºå™¨äººï¼š

```
/aigm llm add test gpt-3.5-turbo https://api.openai.com/v1 sk-test
/aigm llm list
```

åº”æ˜¾ç¤ºå·²æ·»åŠ çš„é¢„è®¾ï¼ˆAPI Key ä¼šè¢«æ©ç æ˜¾ç¤ºï¼‰ã€‚

### 3. æµ‹è¯•é¢„è®¾ç»‘å®š

åœ¨ç¾¤èŠä¸­ï¼š

```
/aigm llm bind test 1h
/aigm llm status
```

åº”æ˜¾ç¤ºç»‘å®šæˆåŠŸå¹¶å±•ç¤ºå½“å‰çŠ¶æ€ã€‚

### 4. æµ‹è¯•æ¸¸æˆå¯åŠ¨

ä¸Šä¼ ä¸€ä¸ª `.txt` æˆ– `.md` æ–‡ä»¶ï¼Œç¡®è®¤æ¸¸æˆèƒ½æ­£å¸¸å¯åŠ¨ã€‚

---

## â“ å¸¸è§é—®é¢˜

### Q1: å‡çº§åæ— æ³•å¯åŠ¨æ¸¸æˆï¼Œæç¤º"æœªç»‘å®š LLM ç®—åŠ›"

**A:** è¿™æ˜¯æ­£å¸¸çš„ï¼æ–°ç‰ˆæœ¬ç§»é™¤äº†å…¨å±€ API é…ç½®ã€‚éœ€è¦ï¼š
1. ç”¨æˆ·ç§èŠæ·»åŠ é¢„è®¾
2. åœ¨ç¾¤èŠä¸­ç»‘å®šé¢„è®¾

### Q2: å¯†é’¥æ–‡ä»¶ä¸¢å¤±ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ

**A:** å¦‚æœæ²¡æœ‰å¤‡ä»½ï¼Œ**æ— æ³•æ¢å¤**ã€‚éœ€è¦ï¼š
1. åˆ é™¤ `data/llm_presets.json`
2. é‡å¯æœåŠ¡ï¼ˆç”Ÿæˆæ–°å¯†é’¥ï¼‰
3. æ‰€æœ‰ç”¨æˆ·é‡æ–°æ·»åŠ é¢„è®¾

### Q3: å¦‚ä½•è¿ç§»æ—§çš„ API é…ç½®ï¼Ÿ

**A:** éœ€è¦æ‰‹åŠ¨è¿ç§»ï¼š
1. ä»æ—§ `config.json` ä¸­å¤åˆ¶ API Key
2. é€šè¿‡ç§èŠæ·»åŠ ä¸ºæ–°é¢„è®¾
3. åœ¨ç¾¤èŠä¸­ç»‘å®šè¯¥é¢„è®¾

### Q4: å¤šå®ä¾‹éƒ¨ç½²å¦‚ä½•å…±äº«é¢„è®¾ï¼Ÿ

**A:** å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒã€‚å»ºè®®ï¼š
- æ–¹æ¡ˆ1ï¼šä½¿ç”¨å…±äº«æŒä¹…å·ï¼ˆéœ€ç¡®ä¿æ–‡ä»¶é”å®‰å…¨ï¼‰
- æ–¹æ¡ˆ2ï¼šæ¯ä¸ªå®ä¾‹ç‹¬ç«‹é…ç½®

### Q5: é¢„è®¾è¢«åˆ é™¤åæ¸¸æˆä¼šæ€æ ·ï¼Ÿ

**A:** å¦‚æœæ¸¸æˆæ­£åœ¨ä½¿ç”¨è¯¥é¢„è®¾ï¼Œä¼šæç¤ºé”™è¯¯å¹¶ä¸­æ–­ã€‚éœ€è¦é‡æ–°ç»‘å®šæœ‰æ•ˆé¢„è®¾ã€‚

---

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šå¯åŠ¨æ—¶æŠ¥é”™ "Failed to initialize encryption"

**è§£å†³ï¼š**

```bash
# æ£€æŸ¥ cryptography æ˜¯å¦æ­£ç¡®å®‰è£…
pip show cryptography

# å¦‚æœæœªå®‰è£…
pip install cryptography

# æ£€æŸ¥ Python ç‰ˆæœ¬ï¼ˆéœ€è¦ 3.8+ï¼‰
python --version
```

### é—®é¢˜ï¼šæ— æ³•åˆ›å»ºå¯†é’¥æ–‡ä»¶

**è§£å†³ï¼š**

```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -ld data/

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•
mkdir -p data
chmod 700 data/
```

### é—®é¢˜ï¼šè§£å¯†å¤±è´¥ "API Key è§£å¯†å¤±è´¥ï¼Œå¯†é’¥å¯èƒ½å·²æŸå"

**å¯èƒ½åŸå› ï¼š**
1. å¯†é’¥æ–‡ä»¶è¢«æ›¿æ¢æˆ–æŸå
2. `llm_presets.json` æ¥è‡ªä¸åŒçš„å¯†é’¥

**è§£å†³ï¼š**
1. ä»å¤‡ä»½æ¢å¤ `.secret.key`
2. å¦‚æœæ— å¤‡ä»½ï¼Œéœ€è¦æ¸…ç©ºé¢„è®¾é‡æ–°é…ç½®

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f logs/aigm.log`
2. æ£€æŸ¥ GitHub Issues
3. åŠ å…¥å¼€å‘è€…ç¤¾åŒº

---

## ğŸ‰ å‡çº§å®Œæˆ

æ­å–œï¼æ‚¨å·²æˆåŠŸå‡çº§åˆ° v1.1.0ã€‚

**æ–°åŠŸèƒ½ï¼š**
- âœ… ç”¨æˆ·çº§ LLM é¢„è®¾ç®¡ç†
- âœ… çµæ´»çš„ç»‘å®šæœºåˆ¶ï¼ˆFCFS + ä¸´æ—¶ç»‘å®šï¼‰
- âœ… åŠ å¯†å­˜å‚¨ API å¯†é’¥
- âœ… è¿æ¥æ± ä¼˜åŒ–ï¼ˆLRU + ç©ºé—²æ¸…ç†ï¼‰

**å®‰å…¨æ”¹è¿›ï¼š**
- âœ… å¯†é’¥æ–‡ä»¶æƒé™ä¿æŠ¤ï¼ˆ600ï¼‰
- âœ… åŸå­å†™å…¥é˜²æ­¢æ•°æ®æŸå
- âœ… è§£å¯†é”™è¯¯ä¸»åŠ¨æ£€æµ‹

**ä¸‹ä¸€æ­¥å»ºè®®ï¼š**
1. å®šæœŸå¤‡ä»½ `data/.secret.key`
2. ç›‘æ§é¢„è®¾ä½¿ç”¨æƒ…å†µ
3. è€ƒè™‘è®¾ç½®ä¿åº•é¢„è®¾

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
